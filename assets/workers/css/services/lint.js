!function(e){if("object"==typeof module&&"object"==typeof module.exports){var t=e(require,exports);void 0!==t&&(module.exports=t)}else"function"==typeof define&&define.amd&&define(["require","exports","../languageFacts/facts","./lintRules","../parser/cssNodes","./lintUtil","../utils/arrays","vscode-nls"],e)}((function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=e("../languageFacts/facts"),i=e("./lintRules"),n=e("../parser/cssNodes"),a=e("./lintUtil"),o=e("../utils/arrays"),s=e("vscode-nls").loadMessageBundle(),l=function(){function e(){this.data={}}return e.prototype.add=function(e,t,r){var i=this.data[e];i||(i={nodes:[],names:[]},this.data[e]=i),i.names.push(t),r&&i.nodes.push(r)},e}(),d=function(){function e(e,t){var r=this;this.warnings=[],this.settings=t,this.documentText=e.getText(),this.keyframes=new l,this.validProperties={};var n=t.getSetting(i.Settings.ValidProperties);Array.isArray(n)&&n.forEach((function(e){if("string"==typeof e){var t=e.trim().toLowerCase();t.length&&(r.validProperties[t]=!0)}}))}return e.entries=function(t,r,i,n){var a=new e(r,i);return t.acceptVisitor(a),a.completeValidations(),a.getEntries(n)},e.prototype.isValidPropertyDeclaration=function(e){var t=e.getFullPropertyName().toLowerCase();return this.validProperties[t]},e.prototype.fetch=function(e,t){for(var r=[],i=0,n=e;i<n.length;i++){var a=n[i];a.name===t&&r.push(a)}return r},e.prototype.fetchWithValue=function(e,t,r){for(var i=[],n=0,a=e;n<a.length;n++){var o=a[n];if(o.name===t){var s=o.node.getValue();s&&this.findValueInExpression(s,r)&&i.push(o)}}return i},e.prototype.findValueInExpression=function(e,t){var r=!1;return e.accept((function(e){return e.type===n.NodeType.Identifier&&e.getText()===t&&(r=!0),!r})),r},e.prototype.getEntries=function(e){return void 0===e&&(e=n.Level.Warning|n.Level.Error),this.warnings.filter((function(t){return 0!=(t.getLevel()&e)}))},e.prototype.addEntry=function(e,t,r){var i=new n.Marker(e,t,this.settings.getRule(t),r);this.warnings.push(i)},e.prototype.getMissingNames=function(e,t){e=e.slice(0);for(var r=0;r<t.length;r++){var i=e.indexOf(t[r]);-1!==i&&(e[i]=null)}var n=null;for(r=0;r<e.length;r++){var a=e[r];a&&(n=null===n?s("namelist.single","'{0}'",a):s("namelist.concatenated","{0}, '{1}'",n,a))}return n},e.prototype.visitNode=function(e){switch(e.type){case n.NodeType.UnknownAtRule:return this.visitUnknownAtRule(e);case n.NodeType.Keyframe:return this.visitKeyframe(e);case n.NodeType.FontFace:return this.visitFontFace(e);case n.NodeType.Ruleset:return this.visitRuleSet(e);case n.NodeType.SimpleSelector:return this.visitSimpleSelector(e);case n.NodeType.Function:return this.visitFunction(e);case n.NodeType.NumericValue:return this.visitNumericValue(e);case n.NodeType.Import:return this.visitImport(e);case n.NodeType.HexColorValue:return this.visitHexColorValue(e);case n.NodeType.Prio:return this.visitPrio(e)}return!0},e.prototype.completeValidations=function(){this.validateKeyframes()},e.prototype.visitUnknownAtRule=function(e){var t=e.getChild(0);return!!t&&(this.addEntry(t,i.Rules.UnknownAtRules,"Unknown at rule "+t.getText()),!0)},e.prototype.visitKeyframe=function(e){var t=e.getKeyword(),r=t.getText();return this.keyframes.add(e.getName(),r,"@keyframes"!==r?t:null),!0},e.prototype.validateKeyframes=function(){var e=["@-webkit-keyframes","@-moz-keyframes","@-o-keyframes"];for(var t in this.keyframes.data){var r=this.keyframes.data[t].names,n=-1===r.indexOf("@keyframes");if(n||1!==r.length){var a=this.getMissingNames(e,r);if(a||n)for(var o=0,l=this.keyframes.data[t].nodes;o<l.length;o++){var d=l[o];if(n){var u=s("keyframes.standardrule.missing","Always define standard rule '@keyframes' when defining keyframes.");this.addEntry(d,i.Rules.IncludeStandardPropertyWhenUsingVendorPrefix,u)}if(a){u=s("keyframes.vendorspecific.missing","Always include all vendor specific rules: Missing: {0}",a);this.addEntry(d,i.Rules.AllVendorPrefixes,u)}}}}return!0},e.prototype.visitSimpleSelector=function(e){var t=this.documentText.charAt(e.offset);return 1===e.length&&"*"===t&&this.addEntry(e,i.Rules.UniversalSelector),"#"===t&&this.addEntry(e,i.Rules.AvoidIdSelector),!0},e.prototype.visitImport=function(e){return this.addEntry(e,i.Rules.ImportStatemement),!0},e.prototype.visitRuleSet=function(t){var d=t.getDeclarations();if(!d)return!1;d.hasChildren()||this.addEntry(t.getSelectors(),i.Rules.EmptyRuleSet);for(var u=[],p=0,f=d.getChildren();p<f.length;p++){if((A=f[p])instanceof n.Declaration){var h=A;u.push(new a.Element(h.getFullPropertyName().toLowerCase(),h))}}var c=a.default(u);if(c.width){var y=[];if(c.right.value&&(y=o.union(y,c.right.properties)),c.left.value&&(y=o.union(y,c.left.properties)),0!==y.length){for(var g=0,v=y;g<v.length;g++){var m=v[g];this.addEntry(m.node,i.Rules.BewareOfBoxModelSize)}this.addEntry(c.width.node,i.Rules.BewareOfBoxModelSize)}}if(c.height){y=[];if(c.top.value&&(y=o.union(y,c.top.properties)),c.bottom.value&&(y=o.union(y,c.bottom.properties)),0!==y.length){for(var P=0,w=y;P<w.length;P++){m=w[P];this.addEntry(m.node,i.Rules.BewareOfBoxModelSize)}this.addEntry(c.height.node,i.Rules.BewareOfBoxModelSize)}}var x=this.fetchWithValue(u,"display","inline");if(x.length>0)for(var R=0,E=["width","height","margin-top","margin-bottom","float"];R<E.length;R++)for(var k=E[R],N=this.fetch(u,k),S=0;S<N.length;S++){var V=N[S].node,D=V.getValue();("float"!==k||D&&!D.matches("none"))&&this.addEntry(V,i.Rules.PropertyIgnoredDueToDisplay,s("rule.propertyIgnoredDueToDisplayInline","Property is ignored due to the display. With 'display: inline', the width, height, margin-top, margin-bottom, and float properties have no effect."))}if((x=this.fetchWithValue(u,"display","inline-block")).length>0)for(N=this.fetch(u,"float"),S=0;S<N.length;S++){var T=N[S].node;(D=T.getValue())&&!D.matches("none")&&this.addEntry(T,i.Rules.PropertyIgnoredDueToDisplay,s("rule.propertyIgnoredDueToDisplayInlineBlock","inline-block is ignored due to the float. If 'float' has a value other than 'none', the box is floated and 'display' is treated as 'block'"))}if((x=this.fetchWithValue(u,"display","block")).length>0)for(N=this.fetch(u,"vertical-align"),S=0;S<N.length;S++)this.addEntry(N[S].node,i.Rules.PropertyIgnoredDueToDisplay,s("rule.propertyIgnoredDueToDisplayBlock","Property is ignored due to the display. With 'display: block', vertical-align should not be used."));var I=this.fetch(u,"float");for(S=0;S<I.length;S++){h=I[S].node;this.isValidPropertyDeclaration(h)||this.addEntry(h,i.Rules.AvoidFloat)}for(var b=0;b<u.length;b++){var A;if("background"!==(A=u[b]).name&&!this.validProperties[A.name])if((D=A.node.getValue())&&"-"!==this.documentText.charAt(D.offset)){var F=this.fetch(u,A.name);if(F.length>1)for(var C=0;C<F.length;C++){var M=F[C].node.getValue();M&&"-"!==this.documentText.charAt(M.offset)&&F[C]!==A&&this.addEntry(A.node,i.Rules.DuplicateDeclarations)}}}if(!(":export"===t.getSelectors().getText())){for(var U=new l,B=!1,L=0,W=d.getChildren();L<W.length;L++){var K=W[L];if(this.isCSSDeclaration(K)){var O=(h=K).getFullPropertyName().toLowerCase(),z=O.charAt(0);if("-"===z){if("-"!==O.charAt(1)){r.cssDataManager.isKnownProperty(O)||this.validProperties[O]||this.addEntry(h.getProperty(),i.Rules.UnknownVendorSpecificProperty);var H=h.getNonPrefixedPropertyName();U.add(H,O,h.getProperty())}}else{var j=O;"*"!==z&&"_"!==z||(this.addEntry(h.getProperty(),i.Rules.IEStarHack),O=O.substr(1)),r.cssDataManager.isKnownProperty(j)||r.cssDataManager.isKnownProperty(O)||this.validProperties[O]||this.addEntry(h.getProperty(),i.Rules.UnknownProperty,s("property.unknownproperty.detailed","Unknown property: '{0}'",O)),U.add(O,O,null)}}else B=!0}if(!B)for(var q in U.data){var _=U.data[q],Z=_.names,G=r.cssDataManager.isStandardProperty(q)&&-1===Z.indexOf(q);if(G||1!==Z.length){for(var J=[],Q=(b=0,e.prefixes.length);b<Q;b++){var X=e.prefixes[b];r.cssDataManager.isStandardProperty(X+q)&&J.push(X+q)}var Y=this.getMissingNames(J,Z);if(Y||G)for(var $=0,ee=_.nodes;$<ee.length;$++){var te=ee[$];if(G){var re=s("property.standard.missing","Also define the standard property '{0}' for compatibility",q);this.addEntry(te,i.Rules.IncludeStandardPropertyWhenUsingVendorPrefix,re)}if(Y){re=s("property.vendorspecific.missing","Always include all vendor specific properties: Missing: {0}",Y);this.addEntry(te,i.Rules.AllVendorPrefixes,re)}}}}}return!0},e.prototype.visitPrio=function(e){return this.addEntry(e,i.Rules.AvoidImportant),!0},e.prototype.visitNumericValue=function(e){var t=e.findParent(n.NodeType.Function);if(t&&"calc"===t.getName())return!0;var a=e.findParent(n.NodeType.Declaration);if(a&&a.getValue()){var o=e.getValue();if(!o.unit||-1===r.units.length.indexOf(o.unit.toLowerCase()))return!0;0===parseFloat(o.value)&&o.unit&&!this.validProperties[a.getFullPropertyName()]&&this.addEntry(e,i.Rules.ZeroWithUnit)}return!0},e.prototype.visitFontFace=function(e){var t=e.getDeclarations();if(t){for(var r=!1,n=!1,a=!1,o=0,s=t.getChildren();o<s.length;o++){var l=s[o];if(this.isCSSDeclaration(l)){var d=l.getProperty().getName().toLowerCase();"src"===d&&(r=!0),"font-family"===d&&(n=!0)}else a=!0}return a||r&&n||this.addEntry(e,i.Rules.RequiredPropertiesForFontFace),!0}},e.prototype.isCSSDeclaration=function(e){if(e instanceof n.Declaration){if(!e.getValue())return!1;var t=e.getProperty();return!(!t||t.getIdentifier().containsInterpolation())}return!1},e.prototype.visitHexColorValue=function(e){var t=e.length;return 9!==t&&7!==t&&5!==t&&4!==t&&this.addEntry(e,i.Rules.HexColorLength),!1},e.prototype.visitFunction=function(e){var t=e.getName().toLowerCase(),r=-1,a=0;switch(t){case"rgb(":case"hsl(":r=3;break;case"rgba(":case"hsla(":r=4}return-1!==r&&(e.getArguments().accept((function(e){return!(e instanceof n.BinaryExpression)||(a+=1,!1)})),a!==r&&this.addEntry(e,i.Rules.ArgsInColorFunction)),!0},e.prefixes=["-ms-","-moz-","-o-","-webkit-"],e}();t.LintVisitor=d}));
var __extends=this&&this.__extends||function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},e(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();!function(e){if("object"==typeof module&&"object"==typeof module.exports){var t=e(require,exports);void 0!==t&&(module.exports=t)}else"function"==typeof define&&define.amd&&define(["require","exports","./scssScanner","./cssScanner","./cssParser","./cssNodes","./scssErrors","./cssErrors"],e)}((function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=e("./scssScanner"),i=e("./cssScanner"),s=e("./cssParser"),n=e("./cssNodes"),a=e("./scssErrors"),o=e("./cssErrors"),p=function(e){function t(){return e.call(this,new r.SCSSScanner)||this}return __extends(t,e),t.prototype._parseStylesheetStatement=function(){return this.peek(i.TokenType.AtKeyword)?this._parseWarnAndDebug()||this._parseControlStatement()||this._parseMixinDeclaration()||this._parseMixinContent()||this._parseMixinReference()||this._parseFunctionDeclaration()||e.prototype._parseStylesheetAtStatement.call(this):this._parseRuleset(!0)||this._parseVariableDeclaration()},t.prototype._parseImport=function(){if(!this.peekKeyword("@import"))return null;var e=this.create(n.Import);if(this.consumeToken(),!e.addChild(this._parseURILiteral())&&!e.addChild(this._parseStringLiteral()))return this.finish(e,o.ParseError.URIOrStringExpected);for(;this.accept(i.TokenType.Comma);)if(!e.addChild(this._parseURILiteral())&&!e.addChild(this._parseStringLiteral()))return this.finish(e,o.ParseError.URIOrStringExpected);return this.peek(i.TokenType.SemiColon)||this.peek(i.TokenType.EOF)||e.setMedialist(this._parseMediaQueryList()),this.finish(e)},t.prototype._parseVariableDeclaration=function(e){if(void 0===e&&(e=[]),!this.peek(r.VariableName))return null;var t=this.create(n.VariableDeclaration);if(!t.setVariable(this._parseVariable()))return null;if(!this.accept(i.TokenType.Colon))return this.finish(t,o.ParseError.ColonExpected);if(t.colonPosition=this.prevToken.offset,!t.setValue(this._parseExpr()))return this.finish(t,o.ParseError.VariableValueExpected,[],e);for(;this.accept(i.TokenType.Exclamation);){if(!this.peekRegExp(i.TokenType.Ident,/^(default|global)$/))return this.finish(t,o.ParseError.UnknownKeyword);this.consumeToken()}return this.peek(i.TokenType.SemiColon)&&(t.semicolonPosition=this.token.offset),this.finish(t)},t.prototype._parseMediaFeatureName=function(){return this._parseFunction()||this._parseIdent()||this._parseVariable()},t.prototype._parseKeyframeSelector=function(){return this._tryParseKeyframeSelector()||this._parseControlStatement(this._parseKeyframeSelector.bind(this))||this._parseVariableDeclaration()||this._parseMixinContent()},t.prototype._parseVariable=function(){if(!this.peek(r.VariableName))return null;var e=this.create(n.Variable);return this.consumeToken(),e},t.prototype._parseIdent=function(e){var t=this;if(!this.peek(i.TokenType.Ident)&&!this.peek(r.InterpolationFunction)&&!this.peekDelim("-"))return null;var s=this.create(n.Identifier);s.referenceTypes=e,s.isCustomProperty=this.peekRegExp(i.TokenType.Ident,/^--/);for(var a,o=!1;(this.accept(i.TokenType.Ident)||s.addChild((a=void 0,a=t.mark(),t.acceptDelim("-")&&(t.hasWhitespace()||t.acceptDelim("-"),t.hasWhitespace())?(t.restoreAtMark(a),null):t._parseInterpolation()))||o&&(this.acceptDelim("-")||this.accept(i.TokenType.Num)))&&(o=!0,!this.hasWhitespace()););return o?this.finish(s):null},t.prototype._parseTerm=function(){var t=e.prototype._parseTerm.call(this);return t||((t=this.create(n.Term)).setExpression(this._parseVariable())||t.setExpression(this._parseSelectorCombinator())||t.setExpression(this._tryParsePrio())?this.finish(t):null)},t.prototype._parseInterpolation=function(){if(this.peek(r.InterpolationFunction)){var e=this.create(n.Interpolation);return this.consumeToken(),e.addChild(this._parseExpr())||this._parseSelectorCombinator()?this.accept(i.TokenType.CurlyR)?this.finish(e):this.finish(e,o.ParseError.RightCurlyExpected):this.accept(i.TokenType.CurlyR)?this.finish(e):this.finish(e,o.ParseError.ExpressionExpected)}return null},t.prototype._parseOperator=function(){if(this.peek(r.EqualsOperator)||this.peek(r.NotEqualsOperator)||this.peek(r.GreaterEqualsOperator)||this.peek(r.SmallerEqualsOperator)||this.peekDelim(">")||this.peekDelim("<")||this.peekIdent("and")||this.peekIdent("or")||this.peekDelim("%")){var t=this.createNode(n.NodeType.Operator);return this.consumeToken(),this.finish(t)}return e.prototype._parseOperator.call(this)},t.prototype._parseUnaryOperator=function(){if(this.peekIdent("not")){var t=this.create(n.Node);return this.consumeToken(),this.finish(t)}return e.prototype._parseUnaryOperator.call(this)},t.prototype._parseRuleSetDeclaration=function(){return this.peek(i.TokenType.AtKeyword)?this._parseKeyframe()||this._parseImport()||this._parseMedia(!0)||this._parseFontFace()||this._parseWarnAndDebug()||this._parseControlStatement()||this._parseFunctionDeclaration()||this._parseExtends()||this._parseMixinReference()||this._parseMixinContent()||this._parseMixinDeclaration()||this._parseRuleset(!0)||this._parseSupports(!0):this._parseVariableDeclaration()||this._tryParseRuleset(!0)||e.prototype._parseRuleSetDeclaration.call(this)},t.prototype._parseDeclaration=function(e){var t=this.create(n.Declaration);if(!t.setProperty(this._parseProperty()))return null;if(!this.accept(i.TokenType.Colon))return this.finish(t,o.ParseError.ColonExpected,[i.TokenType.Colon],e);t.colonPosition=this.prevToken.offset;var r=!1;if(t.setValue(this._parseExpr())&&(r=!0,t.addChild(this._parsePrio())),this.peek(i.TokenType.CurlyL))t.setNestedProperties(this._parseNestedProperties());else if(!r)return this.finish(t,o.ParseError.PropertyValueExpected);return this.peek(i.TokenType.SemiColon)&&(t.semicolonPosition=this.token.offset),this.finish(t)},t.prototype._parseNestedProperties=function(){var e=this.create(n.NestedProperties);return this._parseBody(e,this._parseDeclaration.bind(this))},t.prototype._parseExtends=function(){if(this.peekKeyword("@extend")){var e=this.create(n.ExtendsReference);if(this.consumeToken(),!e.getSelectors().addChild(this._parseSimpleSelector()))return this.finish(e,o.ParseError.SelectorExpected);for(;this.accept(i.TokenType.Comma);)e.getSelectors().addChild(this._parseSimpleSelector());return this.accept(i.TokenType.Exclamation)&&!this.acceptIdent("optional")?this.finish(e,o.ParseError.UnknownKeyword):this.finish(e)}return null},t.prototype._parseSimpleSelectorBody=function(){return this._parseSelectorCombinator()||this._parseSelectorPlaceholder()||e.prototype._parseSimpleSelectorBody.call(this)},t.prototype._parseSelectorCombinator=function(){if(this.peekDelim("&")){var e=this.createNode(n.NodeType.SelectorCombinator);for(this.consumeToken();!this.hasWhitespace()&&(this.acceptDelim("-")||this.accept(i.TokenType.Num)||this.accept(i.TokenType.Dimension)||e.addChild(this._parseIdent())||this.acceptDelim("&")););return this.finish(e)}return null},t.prototype._parseSelectorPlaceholder=function(){if(this.peekDelim("%")){var e=this.createNode(n.NodeType.SelectorPlaceholder);return this.consumeToken(),this._parseIdent(),this.finish(e)}if(this.peekKeyword("@at-root")){e=this.createNode(n.NodeType.SelectorPlaceholder);return this.consumeToken(),this.finish(e)}return null},t.prototype._parseElementName=function(){var t=this.mark(),r=e.prototype._parseElementName.call(this);return r&&!this.hasWhitespace()&&this.peek(i.TokenType.ParenthesisL)?(this.restoreAtMark(t),null):r},t.prototype._tryParsePseudoIdentifier=function(){return this._parseInterpolation()||e.prototype._tryParsePseudoIdentifier.call(this)},t.prototype._parseWarnAndDebug=function(){if(!this.peekKeyword("@debug")&&!this.peekKeyword("@warn")&&!this.peekKeyword("@error"))return null;var e=this.createNode(n.NodeType.Debug);return this.consumeToken(),e.addChild(this._parseExpr()),this.finish(e)},t.prototype._parseControlStatement=function(e){return void 0===e&&(e=this._parseRuleSetDeclaration.bind(this)),this.peek(i.TokenType.AtKeyword)?this._parseIfStatement(e)||this._parseForStatement(e)||this._parseEachStatement(e)||this._parseWhileStatement(e):null},t.prototype._parseIfStatement=function(e){return this.peekKeyword("@if")?this._internalParseIfStatement(e):null},t.prototype._internalParseIfStatement=function(e){var t=this.create(n.IfStatement);if(this.consumeToken(),!t.setExpression(this._parseExpr(!0)))return this.finish(t,o.ParseError.ExpressionExpected);if(this._parseBody(t,e),this.acceptKeyword("@else"))if(this.peekIdent("if"))t.setElseClause(this._internalParseIfStatement(e));else if(this.peek(i.TokenType.CurlyL)){var r=this.create(n.ElseStatement);this._parseBody(r,e),t.setElseClause(r)}return this.finish(t)},t.prototype._parseForStatement=function(e){if(!this.peekKeyword("@for"))return null;var t=this.create(n.ForStatement);return this.consumeToken(),t.setVariable(this._parseVariable())?this.acceptIdent("from")?t.addChild(this._parseBinaryExpr())?this.acceptIdent("to")||this.acceptIdent("through")?t.addChild(this._parseBinaryExpr())?this._parseBody(t,e):this.finish(t,o.ParseError.ExpressionExpected,[i.TokenType.CurlyR]):this.finish(t,a.SCSSParseError.ThroughOrToExpected,[i.TokenType.CurlyR]):this.finish(t,o.ParseError.ExpressionExpected,[i.TokenType.CurlyR]):this.finish(t,a.SCSSParseError.FromExpected,[i.TokenType.CurlyR]):this.finish(t,o.ParseError.VariableNameExpected,[i.TokenType.CurlyR])},t.prototype._parseEachStatement=function(e){if(!this.peekKeyword("@each"))return null;var t=this.create(n.EachStatement);this.consumeToken();var r=t.getVariables();if(!r.addChild(this._parseVariable()))return this.finish(t,o.ParseError.VariableNameExpected,[i.TokenType.CurlyR]);for(;this.accept(i.TokenType.Comma);)if(!r.addChild(this._parseVariable()))return this.finish(t,o.ParseError.VariableNameExpected,[i.TokenType.CurlyR]);return this.finish(r),this.acceptIdent("in")?t.addChild(this._parseExpr())?this._parseBody(t,e):this.finish(t,o.ParseError.ExpressionExpected,[i.TokenType.CurlyR]):this.finish(t,a.SCSSParseError.InExpected,[i.TokenType.CurlyR])},t.prototype._parseWhileStatement=function(e){if(!this.peekKeyword("@while"))return null;var t=this.create(n.WhileStatement);return this.consumeToken(),t.addChild(this._parseBinaryExpr())?this._parseBody(t,e):this.finish(t,o.ParseError.ExpressionExpected,[i.TokenType.CurlyR])},t.prototype._parseFunctionBodyDeclaration=function(){return this._parseVariableDeclaration()||this._parseReturnStatement()||this._parseWarnAndDebug()||this._parseControlStatement(this._parseFunctionBodyDeclaration.bind(this))},t.prototype._parseFunctionDeclaration=function(){if(!this.peekKeyword("@function"))return null;var e=this.create(n.FunctionDeclaration);if(this.consumeToken(),!e.setIdentifier(this._parseIdent([n.ReferenceType.Function])))return this.finish(e,o.ParseError.IdentifierExpected,[i.TokenType.CurlyR]);if(!this.accept(i.TokenType.ParenthesisL))return this.finish(e,o.ParseError.LeftParenthesisExpected,[i.TokenType.CurlyR]);if(e.getParameters().addChild(this._parseParameterDeclaration()))for(;this.accept(i.TokenType.Comma)&&!this.peek(i.TokenType.ParenthesisR);)if(!e.getParameters().addChild(this._parseParameterDeclaration()))return this.finish(e,o.ParseError.VariableNameExpected);return this.accept(i.TokenType.ParenthesisR)?this._parseBody(e,this._parseFunctionBodyDeclaration.bind(this)):this.finish(e,o.ParseError.RightParenthesisExpected,[i.TokenType.CurlyR])},t.prototype._parseReturnStatement=function(){if(!this.peekKeyword("@return"))return null;var e=this.createNode(n.NodeType.ReturnStatement);return this.consumeToken(),e.addChild(this._parseExpr())?this.finish(e):this.finish(e,o.ParseError.ExpressionExpected)},t.prototype._parseMixinDeclaration=function(){if(!this.peekKeyword("@mixin"))return null;var e=this.create(n.MixinDeclaration);if(this.consumeToken(),!e.setIdentifier(this._parseIdent([n.ReferenceType.Mixin])))return this.finish(e,o.ParseError.IdentifierExpected,[i.TokenType.CurlyR]);if(this.accept(i.TokenType.ParenthesisL)){if(e.getParameters().addChild(this._parseParameterDeclaration()))for(;this.accept(i.TokenType.Comma)&&!this.peek(i.TokenType.ParenthesisR);)if(!e.getParameters().addChild(this._parseParameterDeclaration()))return this.finish(e,o.ParseError.VariableNameExpected);if(!this.accept(i.TokenType.ParenthesisR))return this.finish(e,o.ParseError.RightParenthesisExpected,[i.TokenType.CurlyR])}return this._parseBody(e,this._parseRuleSetDeclaration.bind(this))},t.prototype._parseParameterDeclaration=function(){var e=this.create(n.FunctionParameter);return e.setIdentifier(this._parseVariable())?(this.accept(r.Ellipsis),this.accept(i.TokenType.Colon)&&!e.setDefaultValue(this._parseExpr(!0))?this.finish(e,o.ParseError.VariableValueExpected,[],[i.TokenType.Comma,i.TokenType.ParenthesisR]):this.finish(e)):null},t.prototype._parseMixinContent=function(){if(!this.peekKeyword("@content"))return null;var e=this.createNode(n.NodeType.MixinContent);return this.consumeToken(),this.finish(e)},t.prototype._parseMixinReference=function(){if(!this.peekKeyword("@include"))return null;var e=this.create(n.MixinReference);if(this.consumeToken(),!e.setIdentifier(this._parseIdent([n.ReferenceType.Mixin])))return this.finish(e,o.ParseError.IdentifierExpected,[i.TokenType.CurlyR]);if(this.accept(i.TokenType.ParenthesisL)){if(e.getArguments().addChild(this._parseFunctionArgument()))for(;this.accept(i.TokenType.Comma)&&!this.peek(i.TokenType.ParenthesisR);)if(!e.getArguments().addChild(this._parseFunctionArgument()))return this.finish(e,o.ParseError.ExpressionExpected);if(!this.accept(i.TokenType.ParenthesisR))return this.finish(e,o.ParseError.RightParenthesisExpected)}if(this.peek(i.TokenType.CurlyL)){var t=this.create(n.BodyDeclaration);this._parseBody(t,this._parseMixinReferenceBodyStatement.bind(this)),e.setContent(t)}return this.finish(e)},t.prototype._parseMixinReferenceBodyStatement=function(){return this._tryParseKeyframeSelector()||this._parseRuleSetDeclaration()},t.prototype._parseFunctionArgument=function(){var e=this.create(n.FunctionArgument),t=this.mark(),s=this._parseVariable();if(s)if(this.accept(i.TokenType.Colon))e.setIdentifier(s);else{if(this.accept(r.Ellipsis))return e.setValue(s),this.finish(e);this.restoreAtMark(t)}return e.setValue(this._parseExpr(!0))?(this.accept(r.Ellipsis),e.addChild(this._parsePrio()),this.finish(e)):null},t.prototype._parseURLArgument=function(){var t=this.mark(),r=e.prototype._parseURLArgument.call(this);if(!r||!this.peek(i.TokenType.ParenthesisR)){this.restoreAtMark(t);var s=this.create(n.Node);return s.addChild(this._parseBinaryExpr()),this.finish(s)}return r},t.prototype._parseOperation=function(){if(!this.peek(i.TokenType.ParenthesisL))return null;var e=this.create(n.Node);for(this.consumeToken();e.addChild(this._parseListElement());)this.accept(i.TokenType.Comma);return this.accept(i.TokenType.ParenthesisR)?this.finish(e):this.finish(e,o.ParseError.RightParenthesisExpected)},t.prototype._parseListElement=function(){var e=this.create(n.ListEntry),t=this._parseBinaryExpr();if(!t)return null;if(this.accept(i.TokenType.Colon)){if(e.setKey(t),!e.setValue(this._parseBinaryExpr()))return this.finish(e,o.ParseError.ExpressionExpected)}else e.setValue(t);return this.finish(e)},t}(s.Parser);t.SCSSParser=p}));
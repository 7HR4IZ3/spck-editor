!function(e){if("object"==typeof module&&"object"==typeof module.exports){var n=e(require,exports);void 0!==n&&(module.exports=n)}else"function"==typeof define&&define.amd&&define(["require","exports","vscode-languageserver-types","../htmlLanguageTypes","../parser/htmlScanner","../languageFacts/fact"],e)}((function(e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var t=e("vscode-languageserver-types"),a=e("../htmlLanguageTypes"),i=e("../parser/htmlScanner"),r=e("../languageFacts/fact");n.getFoldingRanges=function(e,n){var o=i.createScanner(e.getText()),s=o.scan(),g=[],f=[],l=null,d=-1;function p(e){g.push(e),d=e.startLine}for(;s!==a.TokenType.EOS;){switch(s){case a.TokenType.StartTag:var u=o.getTokenText(),T=e.positionAt(o.getTokenOffset()).line;f.push({startLine:T,tagName:u}),l=u;break;case a.TokenType.EndTag:l=o.getTokenText();break;case a.TokenType.StartTagClose:if(!l||!r.isVoidElement(l))break;case a.TokenType.EndTagClose:case a.TokenType.StartTagSelfClose:for(var c=f.length-1;c>=0&&f[c].tagName!==l;)c--;if(c>=0){var L=f[c];f.length=c,(v=e.positionAt(o.getTokenOffset()).line-1)>(T=L.startLine)&&d!==T&&p({startLine:T,endLine:v})}break;case a.TokenType.Comment:T=e.positionAt(o.getTokenOffset()).line;var h=o.getTokenText().match(/^\s*#(region\b)|(endregion\b)/);if(h)if(h[1])f.push({startLine:T,tagName:""});else{for(c=f.length-1;c>=0&&f[c].tagName.length;)c--;if(c>=0){var v;L=f[c];f.length=c,(v=T)>(T=L.startLine)&&d!==T&&p({startLine:T,endLine:v,kind:t.FoldingRangeKind.Region})}}else T<(v=e.positionAt(o.getTokenOffset()+o.getTokenLength()).line)&&p({startLine:T,endLine:v,kind:t.FoldingRangeKind.Comment})}s=o.scan()}var k=n&&n.rangeLimit||Number.MAX_VALUE;return g.length>k?function(e,n){e=e.sort((function(e,n){var t=e.startLine-n.startLine;return 0===t&&(t=e.endLine-n.endLine),t}));for(var t=void 0,a=[],i=[],r=[],o=function(e,n){i[e]=n,n<30&&(r[n]=(r[n]||0)+1)},s=0;s<e.length;s++){var g=e[s];if(t){if(g.startLine>t.startLine)if(g.endLine<=t.endLine)a.push(t),t=g,o(s,a.length);else if(g.startLine>t.endLine){do{t=a.pop()}while(t&&g.startLine>t.endLine);t&&a.push(t),t=g,o(s,a.length)}}else t=g,o(s,0)}var f=0,l=0;for(s=0;s<r.length;s++){var d=r[s];if(d){if(d+f>n){l=s;break}f+=d}}var p=[];for(s=0;s<e.length;s++){var u=i[s];"number"==typeof u&&(u<l||u===l&&f++<n)&&p.push(e[s])}return p}(g,k):g}}));